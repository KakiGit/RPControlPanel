<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Raspberry Pi Control Panel</title>
    <script src="js/jquery-3.2.1.min.js" type="text/javascript"></script>
    <script src="js/bootstrap.min.js" type="text/javascript"></script>
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="css/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
        .page-header {
            margin: 20px 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 0;
            text-align: center;
        }

        .btn-item {
            text-align: center;
        }

        i {
            margin-right: 3px;
            display: inline-block;
        }

        h1 {
            text-align: center;
        }

        .tip {
            font-weight: bold;
            color: black;
        }

        .lead {
            font-size: small;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="page-header">
            <h3>
                Raspberry Pi Control Panel</h3>
            <p class="lead">
                Easy way to use Raspberry PI
            </p>
            <div class="text-center" id="ipaddr">----</div>
            <script>
                console.log("I am here")
                var ws
                $.ajax({
                    type: "POST",
                    url: "ajax/stats.php",
                    success: function (result) {
                        $("#ipaddr").text(result)
                        ws = new WebSocket("ws://" + result + ":9011")
                    }
                });
            </script>
        </div>
        <div class="panel panel-primary">
            <div class="panel-heading">
                设备</div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-xs-3 btn-item">
                    </div>
                    <div class="col-xs-3 btn-item">
                        <button type="button" class="btn btn-danger btn-trigger">
                            <i class="fa fa-power-off"></i>关机</button>
                    </div>
                    <div class="col-xs-3 btn-item">
                        <button type="button" class="btn btn-primary btn-trigger">
                            <i class="fa fa-refresh"></i>重启</button>
                    </div>
                    <div class="col-xs-3 btn-item">
                    </div>
                    <script type="text/javascript">
                        var url = "ajax/pi.php";
                        $(function () {
                            $(".btn-trigger").click(function () {
                                var text = $(this).text().replace(/ /g, "").replace(/\n/g, "").replace(/\r/g, "").replace(/\t/g, "");
                                var cmd = "";
                                switch (text) {
                                    case "关机":
                                        cmd = "sudo shutdown -h now";
                                        break;
                                    case "重启":
                                        cmd = "sudo reboot";
                                        break;
                                }
                                if (confirm("确定要执行该命令吗？")) {
                                    $.ajax({
                                        type: "POST",
                                        url: url,
                                        data: {
                                            action: "set-linux-cmd",
                                            cmd: cmd
                                        },
                                        success: function (result) {
                                            $(".tip").html(result);
                                        }
                                    });
                                }
                            });
                        });
                    </script>
                </div>
            </div>
        </div>
        <div class="panel panel-primary">
            <div class="panel-heading">
                插件</div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-xs-12">
                        <button type="button" class="btn btn-primary" id="aria2">Aria2</button>
                        <button type="button" class="btn btn-primary" id="download">下载</button>
                        <script type="text/javascript">
                            $(function () {
                                $("#aria2").click(function () {
                                    window.open("./webui-aria2/index.html")
                                });
                                $("#download").click(function () {
                                    window.open("./webui-aria2/Downloads/")
                                });
                            });
                        </script>

                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-primary">
            <div class="panel-heading">
                传感器</div>
            <div class="panel-body">
                <div class="row col-xs-12">
                    <div class="btn-group-vertical col-xs-2">
                        <div class="btn text-center btn-default">
                            <img class="text-center" src="png/Temperature.png" height="20px" />
                        </div>
                        <div class="btn text-center btn-default" id="Temperature">--</div>
                    </div>
                    <div class="btn-group-vertical col-xs-2">
                        <div class="btn text-center btn-default">
                            <img class="text-center" src="png/usagecomputer.png" height="20px" />
                        </div>
                        <div class="btn btn-default text-center" id="CPU_Usage">--</div>
                    </div>
                    <div class="btn-group-vertical col-xs-2">
                        <div class="btn text-center btn-default">
                            <img class="text-center" src="png/ram.png" height="20px" />
                        </div>
                        <div class="btn btn-default text-center" id="RAM_Avail">--</div>
                    </div>
                    <div class="btn-group-vertical col-xs-2">
                        <div class="btn text-center btn-default">
                            <img class="text-center" src="png/speedcomputer.png" height="20px" />
                        </div>
                        <div class="btn btn-default text-center" id="RAM_Usage">--</div>
                    </div>
                    <div class="btn-group-vertical col-xs-2">
                        <div class="btn text-center btn-default">
                            <img class="text-center" src="png/disk.png" height="20px" />
                        </div>
                        <div class="btn btn-default text-center" id="DISK_Avail">--</div>
                    </div>
                    <div class="btn-group-vertical col-xs-2">
                        <div class="btn text-center btn-default">
                            <img class="text-center" src="png/datausage.png" height="20px" />
                        </div>
                        <div class="btn btn-default text-center" id="DISK_Usage">--</div>
                    </div>
                </div>
                <script type="text/javascript">
                    var interval = setInterval(function () {

                        $.post("ajax/pistats.txt", function (data) {
                            let elements = data.split('\n')
                            $("#Temperature").text(elements[0] + "℃")
                            if (parseInt(elements[0]) >= 60) {
                                $("#Temperature").css("background-color", "#d9534f")
                                $("#Temperature").css("color", "#ffffff")
                            }
                            else {
                                $("#Temperature").css("background-color", "#ffffff")
                                $("#Temperature").css("color", "#000000")
                            }
                            $("#CPU_Usage").text(elements[1] + "%")
                            if (parseInt(elements[1]) >= 80) {
                                $("#CPU_Usage").css("background-color", "#d9534f")
                                $("#CPU_Usage").css("color", "#ffffff")
                            }
                            else {
                                $("#CPU_Usage").css("background-color", "#ffffff")
                                $("#CPU_Usage").css("color", "#000000")
                            }
                            $("#RAM_Avail").text(elements[2] + "M")
                            if (parseInt(elements[2]) <= 200) {
                                $("#RAM_Avail").css("background-color", "#d9534f")
                                $("#RAM_Usage").css("background-color", "#d9534f")
                                $("#RAM_Avail").css("color", "#ffffff")
                                $("#RAM_Usage").css("color", "#ffffff")
                            }
                            else {
                                $("#RAM_Avail").css("background-color", "#ffffff")
                                $("#RAM_Usage").css("background-color", "#ffffff")
                                $("#RAM_Avail").css("color", "#000000")
                                $("#RAM_Usage").css("color", "#000000")
                            }
                            $("#RAM_Usage").text(elements[3] + "%")
                            $("#DISK_Avail").text(elements[4] + "G")
                            if (parseInt(elements[4]) <= 10) {
                                $("#DISK_Avail").css("background-color", "#d9534f")
                                $("#DISK_Usage").css("background-color", "#d9534f")
                                $("#DISK_Avail").css("color", "#ffffff")
                                $("#DISK_Usage").css("color", "#ffffff")
                            }
                            else {
                                $("#DISK_Avail").css("background-color", "#ffffff")
                                $("#DISK_Usage").css("background-color", "#ffffff")
                                $("#DISK_Avail").css("color", "#000000")
                                $("#DISK_Usage").css("color", "#000000")
                            }
                            $("#DISK_Usage").text(elements[5])
                        })


                    }, 1000);
                </script>
            </div>
        </div>
        <div class="panel panel-primary" style="border-color:#555">
            <div class="panel-heading" style="background: #555">
                终端</div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="alert alert-success" style="" role="alert">
                            执行：
                            <span class="tip"> </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>